<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="uqsa">
<title>Importing Models • uqsa</title>
<script src="../deps/jquery-3.6.1/jquery-3.6.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Importing Models">
<meta property="og:description" content="uqsa">
<!-- mathjax --><script src="file:///usr/share/javascript/mathjax/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">uqsa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/uqsa.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-installation">Installation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-installation">
    <a class="dropdown-item" href="../articles/installation.html">Short Instructions</a>
    <a class="dropdown-item" href="../articles/installExplanations.html">Explanation for System Prerequisites</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-documentation">Documentation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-documentation">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/uq.html">Uncertainty Quantification</a>
    <a class="dropdown-item" href="../articles/sa.html">Sensitivity Analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Model and data management</h6>
    <a class="dropdown-item" href="../articles/SBtab.html">SBtab</a>
    <a class="dropdown-item" href="../articles/models.html">Importing Models</a>
    <a class="dropdown-item" href="../articles/data.html">Importing Data</a>
    <a class="dropdown-item" href="../articles/user_model.html">Build your own Model</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Paremeter estimation and uncertainty quantification</h6>
    <a class="dropdown-item" href="../articles/simulate.html">Simulating a Model</a>
    <a class="dropdown-item" href="../articles/ABC_sampling.html">ABC Sampling</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Sensitivity Analysis</h6>
    <a class="dropdown-item" href="../articles/GSA.html">Global Sensitivity Analysis</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/examples_overview.html">Overview</a>
    <a class="dropdown-item" href="../articles/simAKAP79.html">Simulate AKAP79</a>
    <a class="dropdown-item" href="../articles/AKAP79.html">Sample AKAP79</a>
    <a class="dropdown-item" href="../articles/AKAR4.html">Sample AKAR4</a>
    <a class="dropdown-item" href="../articles/shortMakeSharedLibrary.html">Build a Model</a>
    <a class="dropdown-item" href="../articles/mpi.html">Multiple chains via MPI</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Importing Models</h1>
            
      
      
      <div class="d-none name"><code>models.Rmd</code></div>
    </div>

    
    
<p>The most straightforward way to describe the model is through <a href="./SBtab.html">SBtab tables</a>, if the model can be described in
terms of reactions, inputs, and outputs. For other models, the user must
write their own likelihood function (or cost-function, or
objective-function).</p>
<p>It is possible to make models compatible with deSolve (but without
scheduled events):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.tsv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"[.]tsv$"</span>,full.names<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># file names</span></span>
<span><span class="va">sb</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab_from_tsv.html" class="external-link">sbtab_from_tsv</a></span><span class="op">(</span><span class="va">model.tsv</span><span class="op">)</span>          <span class="co"># a list of data.frames</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab_to_vfgen.html" class="external-link">sbtab_to_vfgen</a></span><span class="op">(</span><span class="va">sb</span>,cla<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>       <span class="co"># conservation laws, if any</span></span></code></pre></div>
<p>The function <code>sbtab_to_vfgen</code> will produce several files,
using the model’s name (<code>Document='model_name'</code> attribute of
SBtab):</p>
<ul>
<li>
<code>model_name.vf</code>, a vfgen compatible file</li>
<li>
<code>model_name.mod</code>, a NEURON mod file</li>
<li>
<code>model_name.xml</code>, an SBML file, if you have the R
bindings to libsbml installed in R and libsbml in your system</li>
<li>
<code>*.txt</code>, the math for the ODE system, not tied to any
specification (human readable math text files)</li>
<li>
<code>model.tar.gz</code>, the same text files, bundled as a
zip</li>
<li>
<code>model.zip</code>, the same as <code>tar.gz</code> but for
people who only know <code>zip</code>, for compatibility</li>
</ul>
<p>The vf file is compatible with the <a href="https://warrenweckesser.github.io/vfgen/" class="external-link">vfgen</a> tool, which
creates code in many languages from this <code>vf</code> file (matlab,
cvode, octave, python, xppaut).</p>
<p>Alternatively, you can use our tool, which reads the same file, or
one of the archive files (<code>zip</code>/<code>tar.gz</code>). The
repository <a href="icpm-kth/RPN-derivative">icpm-kth/RPN-derivative</a>
contains a shell script <a href="icpm-kth/RPN/derivative/sh/ode.sh">ode.sh</a>; this script uses
one of three methods to calculate analytical derivatives: 1. <a href="https://maxima.sourceforge.io/" class="external-link">maxima</a>, 2. <a href="https://yacas.readthedocs.io/en/latest/" class="external-link">yacas</a>, 3. the
<code>bin/derivative</code> binary that RPN-derivative contains (after
<code>make &amp;&amp; make install</code>)</p>
<p>The vfgen tool uses the <a href="https://www.ginac.de/" class="external-link">ginac</a>
library to calculate jacobians.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> git clone https://github.com/icpm-kth/RPN-derivative.git</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">$</span> cd RPN-derivative</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">$</span> sh/ode.sh <span class="at">-R</span> <span class="at">--maxima</span> <span class="va">${MODEL</span><span class="op">:-</span>myModel<span class="va">}</span>.vf</span></code></pre></div>
<p>Note: <code>ode.sh</code> is compatible with the same vf files from
SBtabVFGEN, but doesn’t support all of the outputs VFGEN can do, and
does nothing related to delays.</p>
<p>Maxima needs to be installed for this backend to work. Same with
Yacas, if you prefer.</p>
<p>Alternatively:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> git clone https://github.com/icpm-kth/RPN-derivative.git</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">$</span> cd RPN-derivative</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">$</span> make <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> make install</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="ex">$</span> sh/ode.sh <span class="at">-R</span> MODEL.vf</span></code></pre></div>
<p>which by default will use the <code>derivative</code> binary the
third line has installed, hopefully. The R script created this way
contains the functions that <code>deSolve</code> would need to simulate
the model, but also functions that return default initial values,
default parameters, the parameter jacobian, and the output functions (a
model of the measurements available for the system). In the same file,
there is a <code>model</code> variable (named <em>model</em>) which
contains the same functions but with generic names, e.g.:
<code>model$jac()</code> is the jacobian function (<em>generic</em>
means that the model name is not part of the function’s name).</p>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>Our goal is to perform <em>parameter estimation</em>. A <em>systems
biology</em> model typically has parameters that are either reaction
rate coefficients <span class="math inline">\(k_f\)</span>, equilibrium
constants <span class="math inline">\(K_d\)</span>, Hill coefficients,
and many other quantities related to <em>kinetc laws</em>; they are
often unknown or not uniquely determined yet. But, not all parameters of
a model are unknown, and not all model parameters are intrinsic to the
system we study. Some of them model the interventions we do to the model
when performing an experiment. This could be the frequency of a driving
force for a mechanical model, or the amount of a treatment dose (added
to the system) that affects the time course of reactions:</p>
<ul>
<li>a substrate, or buffer</li>
<li>an enzyme,</li>
<li>a silencing agent,</li>
<li>an inhibitor</li>
</ul>
<p>These parameters are known to us, because they are written down in
the protocol. If the input is time dependent, then its dynamics (or
explicit algebraic functions) have to become part of the model. These
input parameters can be different between experiments, but the intrinsic
parameters are always the same.</p>
<p>The ordinary differential equation on the other hand does not need to
know the distinction between known or unknown parameters. For these
reasons:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>parMCMC <span class="ot">&lt;-</span> [...]             <span class="co"># some sampling variable</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">parMap</span>(parMCMC)         <span class="co"># a model compatible parameter vector</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>u <span class="ot">&lt;-</span> experiments[[i]]<span class="sc">$</span>input  <span class="co"># a valid model input vector</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(k,u)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># solve ODE using p</span></span></code></pre></div>
<p>where <code>k</code> are intrinsic, unknown parameters (subject to
sampling), and <code>u</code> are the known input parameters that are
encoded in the <code>input</code> field of an experiment.</p>
<p>If input parameters <code>u</code> exist, then they are always
concatenated (<code>p &lt;-c(k,u)</code>) in that order and passed to
the model, the model’s C code only sees <code>p</code>. The wrapper
functions in the <code>rgsl</code> package do this concatenation when
the solver is called. We sample in logarithmic space, but the solver
gets <code>k</code> and appends the right <code>u</code> for each
experiment, both in linear space.</p>
<p>So, if <code>parMCMC</code> is in log10-space, then
<code>parMap</code> is the transformation to linear-space for the solver
to work in:</p>
<pre><code><span><span class="va">parMap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alexandra Jauhiainen, Olivia Eriksson, Federica Milinanni, Andrei Kramer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
