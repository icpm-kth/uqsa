<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="uqsa">
<title>SMMALA and CaMKII • uqsa</title>
<script src="../deps/jquery-3.6.1/jquery-3.6.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SMMALA and CaMKII">
<meta property="og:description" content="uqsa">
<!-- mathjax --><script src="file:///usr/share/javascript/mathjax/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">uqsa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/uqsa.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-installation">Installation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-installation">
    <a class="dropdown-item" href="../articles/installation.html">Short Instructions</a>
    <a class="dropdown-item" href="../articles/installExplanations.html">Explanation for System Prerequisites</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-documentation">Documentation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-documentation">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/uq.html">Uncertainty Quantification</a>
    <a class="dropdown-item" href="../articles/sa.html">Sensitivity Analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Model and data management</h6>
    <a class="dropdown-item" href="../articles/SBtab.html">SBtab</a>
    <a class="dropdown-item" href="../articles/models.html">Importing Models</a>
    <a class="dropdown-item" href="../articles/data.html">Importing Data</a>
    <a class="dropdown-item" href="../articles/events.html">Transformation Events</a>
    <a class="dropdown-item" href="../articles/user_model.html">Build your own Model</a>
    <a class="dropdown-item" href="../articles/generateCodeInR.html">Generate Model Code</a>
    <a class="dropdown-item" href="../articles/intermediateFiles.html">Advantages of Intermediates</a>
    <a class="dropdown-item" href="../articles/ODE-Model.html">ODE Model</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Paremeter estimation and uncertainty quantification</h6>
    <a class="dropdown-item" href="../articles/simulate.html">Simulating a Model</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Sensitivity Analysis</h6>
    <a class="dropdown-item" href="../articles/GSA.html">Global Sensitivity Analysis</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/examples_overview.html">Overview</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>AKAR4</h6>
    <a class="dropdown-item" href="../articles/simAKAR4stochastic.html">Simulate AKAR4 stochastically</a>
    <a class="dropdown-item" href="../articles/sampleAKAR4stochastic.html">Calibrate stochasic AKAR4</a>
    <a class="dropdown-item" href="../articles/GSA_AKAR4.html">GSA on AKAR4</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>AKAP79</h6>
    <a class="dropdown-item" href="../articles/mpi.html">Multiple chains via MPI</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>CaMKII</h6>
    <a class="dropdown-item" href="../articles/smmala.html">Calibrate CaMKII with SMMALA</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Extra</h6>
    <a class="dropdown-item" href="../articles/extraExamples.html">More examples...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>SMMALA and CaMKII</h1>
            
      
      
      <div class="d-none name"><code>smmala.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://icpm-kth.github.io/uqsa/">uqsa</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="simplified-manifold-metropolis-adjusted-langevin-algorithm">Simplified Manifold Metropolis Adjusted Langevin Algorithm<a class="anchor" aria-label="anchor" href="#simplified-manifold-metropolis-adjusted-langevin-algorithm"></a>
</h2>
<p>The included example model called <em>CaMKII</em> illustartes an
insteresting case: - simulations are very different in consumed cpu time
(by an order of magnitude) - simulation time heavily depends on the used
solver - the data type is <em>Dose Response</em> rather than <em>Time
Series</em> - simulations are very slow compared to the other example
models</p>
<p>This makes the <em>likelihood</em> function (or objective function)
expensive. For this reason, we need to make <em>high quality</em> Markov
chain proposals, to increase the impact that a single likelihood
evaluation makes.</p>
<p>The SMMALA algorithm tries to address this issue and provide update
proposals that traverse a larger distance than what is feasible with the
metropolis algorithm while keeping the same acceptance rate.</p>
<p>These higher quality proposals are informed by the gradient of the
log-likelihood, and its Fisher information matrix.</p>
<p>An ingredient of the Fisher information is the solution’s
sensitivity</p>
<p><span class="math display">\[S(t;x,p)_i^{~j} = \frac{d
x_i(t;p)}{dp_j}\,,\]</span></p>
<p>which is usually quite difficult to get. Instead we approximate it.
The rgsl package will try to approximate the sensitivity in a
deterministic way. The approximation error will make the overall
algorithm less efficient than using exact solutions, but the
approximations are better the closer we are to a steady state.</p>
<p>In this model the data is either in steady state, or very close to
it, so the approximations work very well.</p>
<p>The default parameters are not optimized to fit the data. We don’t
expect a good fit in the initial simulation.</p>
<p>Below we describe two different approaches for this model.
Ultimately, the frist approach makes better use of
compute-resources.</p>
<p>The model is very sensitive to integrator choices, some perform
better some worse. It is very likely that the sundials solvers would
perform much better than the GSL solvers, but even between different GSL
solvers there are big differences in consumed cpu-time.</p>
</div>
<div class="section level2">
<h2 id="dose-sequence-approach">Dose Sequence Approach<a class="anchor" aria-label="anchor" href="#dose-sequence-approach"></a>
</h2>
<p>For this model one of th epossible approaches is to create an event
schedule that applies a certain dose of base calcium or calmodulin
(depending on the experiment) in a sequence. Here is an example dose
sequence of base Ca levels (dose column):</p>
<pre><code>!!SBtab Document='CaMKIIs' TableName='EventScheduleShifman2006Fig1Bsq'      
!TimePoint  !Time  !Transformation  !Dose
ShTP01      0      CaSeq            364
ShTP02      10     CaSeq            2305
ShTP03      20     CaSeq            2548
ShTP04      30     CaSeq            2912
ShTP05      40     CaSeq            3640
ShTP06      50     CaSeq            4126
ShTP08      70     CaSeq            4611
ShTP10      90     CaSeq            5461
ShTP12      110    CaSeq            6067
ShTP14      130    CaSeq            6796
ShTP16      150    CaSeq            7281
ShTP17      160    CaSeq            8495
ShTP18      170    CaSeq            9344
ShTP19      180    CaSeq            24393
ShTP20      190    CaSeq            34101</code></pre>
<p>The transformation event CaSeq is defined in the third row of
<code>Transformation.tsv</code> (named <code>CaSeq</code>):</p>
<pre><code>!!SBtab Document='CaMKIIs' TableName='Transformation'           
!ID     &gt;CaBase  &gt;CaM_0
CaSeq   dose     CaM_0
CaMSeq  CaBase   dose</code></pre>
<p>We represent each experiment as a time series, even though the data
sets were originally represented as dose response curves (a map between
an input [e.g. Ca] and an output [e.g. ActivePP2B]). We arbitrarily set
a time betwen input doses and simulate all points in one series, with
just enough time in-between to reach the next higher steady state from
the current steady state (the steady state level changes with each dose
of base-level Ca).</p>
<p>The table of experiments looks like this (truncated):</p>
<pre><code>!!SBtab SbtabVersion='1.0'  TableType='QuantityMatrix'  TableName='Experiments' Document='CaMKIIs'
!ID                 !Type        &gt;PP1_0  &gt;CaMKII_0  &gt;CaM_0  &gt;PP2B_0  &gt;isOn  !T0  !Event
Bradshaw2003Fig2E   Time Series  0       200        2000    0        TRUE   -60  EventScheduleBradshaw2003Fig2E
Shifman2006Fig1Bsq  Time Series  0       5000       5000    0        TRUE   -60  EventScheduleShifman2006Fig1Bsq
ODonnel2010Fig3Co   Time Series  0       0          0       100      FALSE  -60  EventScheduleODonnel2010Fig3Co
Stemmer1993Fig1tr   Time Series  0       0          300     3        TRUE   -60  EventScheduleStemmer1993Fig1tr
Stemmer1993Fig1fc   Time Series  0       0          30      3        TRUE   -60  EventScheduleStemmer1993Fig1fc
Stemmer1993Fig2Afc  Time Series  0       0          25000   0        TRUE   -60  EventScheduleStemmer1993Fig2Afc</code></pre>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<p>During a simulation, these doses will create a staircase of
equilibria:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f</span>  <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/uqsa_example.html">uqsa_example</a></span><span class="op">(</span><span class="st">"CaMKIIs"</span><span class="op">)</span></span>
<span><span class="va">sb</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab_from_tsv.html" class="external-link">sbtab_from_tsv</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; [tsv] file[1] «Bradshaw2003Fig2E.tsv» belongs to Document «CaMKIIs»</span></span>
<span><span class="co">#&gt;  I'll take this as the Model Name.</span></span>
<span><span class="co">#&gt; Bradshaw2003Fig2E.tsv  Compartment.tsv  Compound.tsv  Constant.tsv  EventScheduleBradshaw2003Fig2E.tsv  EventScheduleODonnel2010Fig3Co.tsv  EventScheduleShifman2006Fig1Bsq.tsv  EventScheduleStemmer1993Fig1fc.tsv  EventScheduleStemmer1993Fig1tr.tsv  EventScheduleStemmer1993Fig2Afc.tsv  Experiments.tsv  Expression.tsv  Input.tsv  ODonnel2010Fig3Co.tsv  Output.tsv  Parameter.tsv  Reaction.tsv  Shifman2006Fig1Bsq.tsv  Stemmer1993Fig1fc.tsv  Stemmer1993Fig1tr.tsv  Stemmer1993Fig2Afc.tsv  Transformation.tsv</span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab.data.html" class="external-link">sbtab.data</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cfile</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/uqsa_example.html">uqsa_example</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span>,f<span class="op">=</span><span class="st">"c"</span><span class="op">)</span></span>
<span><span class="va">modelName</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/checkModel.html">checkModel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span>,<span class="va">cfile</span><span class="op">)</span></span>
<span><span class="co">#&gt; building a shared library from c source, and using GSL odeiv2 as backend (pkg-config is used here).</span></span>
<span><span class="co">#&gt; cc -shared -fPIC `pkg-config --cflags gsl` -o './CaMKIIs.so' '/tmp/RtmpAJRrSc/temp_libpath4a777745142a/uqsa/extdata/CaMKIIs/CaMKIIs_gvf.c' `pkg-config --libs gsl`</span></span>
<span><span class="va">rfile</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/uqsa_example.html">uqsa_example</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span>,pat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"^%s[.]R$"</span>,<span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">rfile</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">CaMKIIs_default</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="va">ex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">input</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## This is a simulation with time points inserted between the measurement times,</span></span>
<span><span class="co">## to see what happens in-between them</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">t_</span> <span class="op">&lt;-</span> <span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputTimes</span></span>
<span>    <span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">measurementTimes</span> <span class="op">&lt;-</span> <span class="va">t_</span></span>
<span>    <span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">t_</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">t_</span><span class="op">)</span>,length.out<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/simulator.c.html">simulator.c</a></span><span class="op">(</span><span class="va">ex</span>,<span class="va">modelName</span>,method <span class="op">=</span> <span class="fu">rgsl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgsl/man/integrationMethod.html" class="external-link">integrationMethod</a></span><span class="op">(</span><span class="st">"msadams"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: rgsl</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">s</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpuSeconds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">y</span>,\<span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="va">l</span><span class="op">$</span><span class="va">cpuSeconds</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cpuSeconds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cpuSeconds</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Bradshaw2003Fig2E Shifman2006Fig1Bsq  ODonnel2010Fig3Co  Stemmer1993Fig1tr </span></span>
<span><span class="co">#&gt;           7.077217           1.840241           0.497266           0.294114 </span></span>
<span><span class="co">#&gt;  Stemmer1993Fig1fc Stemmer1993Fig2Afc </span></span>
<span><span class="co">#&gt;           0.634721           6.669697</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputValues</span><span class="op">)</span>,<span class="fl">2</span>,<span class="va">any</span><span class="op">)</span></span>
<span>        <span class="va">t_</span><span class="op">&lt;-</span><span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputTimes</span></span>
<span>        <span class="va">f_</span><span class="op">&lt;-</span><span class="va">y</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">func</span><span class="op">[</span><span class="op">!</span><span class="va">o</span>,,<span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">m_</span><span class="op">&lt;-</span><span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">measurementTimes</span></span>
<span>        <span class="va">v_</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputValues</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">o</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">e_</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">errorValues</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">o</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">yl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputValues</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">o</span><span class="op">)</span><span class="op">]</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">f_</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">t_</span>,<span class="va">f_</span>,type<span class="op">=</span><span class="st">'l'</span>,xlab<span class="op">=</span><span class="st">'time'</span>,ylab<span class="op">=</span><span class="va">yl</span>,main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="va">m_</span>,<span class="va">v_</span>,<span class="va">m_</span>,<span class="va">v_</span><span class="op">+</span><span class="va">e_</span>,angle<span class="op">=</span><span class="fl">90</span>,length<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">m_</span>,<span class="va">v_</span>,pch<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="va">m_</span>,<span class="va">v_</span>,<span class="va">m_</span>,<span class="va">v_</span><span class="op">-</span><span class="va">e_</span>,angle<span class="op">=</span><span class="fl">90</span>,length<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="smmala_files/figure-html/CaMKIIs-1.png" width="700"></p>
<p>Here we notice that in Experiment 1, the trajectory fails to reach
steady state (i.e. a flat line), for any dose. So, it doesn’t look like
a staircase at all.</p>
<p>It is possible that the default parameter set will not allow the
system to go into steady state quickliy enough, even if we increase the
time between the transformation events.</p>
</div>
<div class="section level3">
<h3 id="asymmetry">Asymmetry<a class="anchor" aria-label="anchor" href="#asymmetry"></a>
</h3>
<p>The experiments for this model are different in complexity. How many
seconds the solver needs to claculate a simulated trajectory depends on
the chosen integration method.</p>
<div class="float">
<img src="./CaMKIIs-integrators-normal.png" alt="Solver timings for CaMKIIs, with indicated Success and Failure."><div class="figcaption">Solver timings for CaMKIIs, with indicated
Success and Failure.</div>
</div>
<p>This Table-screenshot shows that some of the integration methods fail
to return a solution for some of the simulated scenarios, even with the
default parameters. These methods should be excluded from MCMC. The
remaining methods perform very differently. Some of these methods may
fail for parameter-vectors proposed during MCMC.</p>
<p>This al means that the posterior distribution depends on the used
solver: no solution from the chosen solver means that the liklelihood is
0. So, it may be a good idea to use the most robust solver if it means
that more solutions are found.</p>
<p>This is a table of acceptable cpu times in seconds:</p>
<table class="table">
<caption>CPU time measured in seconds, tabulated by experiment for
different step methods. Only Successful simulations are shown.
{#tbl:cpu-time}</caption>
<thead><tr class="header">
<th align="right">id</th>
<th align="right">method</th>
<th align="center">Exp 1</th>
<th align="center">Exp 2</th>
<th align="center">Exp 3</th>
<th align="center">Exp 4</th>
<th align="center">Exp 5</th>
<th align="center">Exp 6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">msbdf</td>
<td align="center">6.603</td>
<td align="center">2.41</td>
<td align="center">1.522</td>
<td align="center">0.035</td>
<td align="center">0.265</td>
<td align="center">37.386</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">msadams</td>
<td align="center">6.822</td>
<td align="center">1.54</td>
<td align="center">0.435</td>
<td align="center">0.287</td>
<td align="center">0.437</td>
<td align="center">6.033</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">rkck</td>
<td align="center">1.703</td>
<td align="center">0.419</td>
<td align="center">0.113</td>
<td align="center">0.077</td>
<td align="center">0.109</td>
<td align="center">1.669</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">rkf45</td>
<td align="center">1.692</td>
<td align="center">0.385</td>
<td align="center">0.129</td>
<td align="center">0.08</td>
<td align="center">0.125</td>
<td align="center">1.656</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">rk2</td>
<td align="center">1.642</td>
<td align="center">0.347</td>
<td align="center">0.104</td>
<td align="center">0.063</td>
<td align="center">0.102</td>
<td align="center">1.498</td>
</tr>
</tbody>
</table>
<p>This table shows that it is vitally important to pick the right
integration method, but also that simulating experiments in parallel is
not always a good idea as some of the threads will return much sooner
than others and idle until the slowest experiment is finished. Starting
more Markov chains may be better in that case.</p>
<p>Here is an example, where we stretched the time-line for the
Experiment named <code>Bradshaw2003Fig2E</code> as it is very slow to
approach steady state and the most problematic experiment in this dose
sequence.</p>
<p>Stretching the time line allows the ODE system more time to converge,
but also increases the simulation time:</p>
<div class="float">
<img src="./CaMKIIs-integrators-stretched-time-1.png" alt="Stretched time line for Experiment 1 (event-shedule and measurement times)."><div class="figcaption">Stretched time line for Experiment 1
(event-shedule and measurement times).</div>
</div>
<p>And again, just the portion where all experiments returned a
result:</p>
<table class="table">
<caption>CPU time measured in seconds, tabulated by experiment for
different step methods. Only Successful simulations are shown.
{#tbl:cpu-time-stretched-1}</caption>
<thead><tr class="header">
<th align="right">id</th>
<th align="right">method</th>
<th align="center">Exp 1</th>
<th align="center">Exp 2</th>
<th align="center">Exp 3</th>
<th align="center">Exp 4</th>
<th align="center">Exp 5</th>
<th align="center">Exp 6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">msbdf</td>
<td align="center">53.16</td>
<td align="center">2.42</td>
<td align="center">1.52</td>
<td align="center">0.04</td>
<td align="center">0.27</td>
<td align="center">39.64</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">msadams</td>
<td align="center">48.23</td>
<td align="center">1.54</td>
<td align="center">0.44</td>
<td align="center">0.29</td>
<td align="center">0.44</td>
<td align="center">5.91</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">rkck</td>
<td align="center">11.81</td>
<td align="center">0.38</td>
<td align="center">0.12</td>
<td align="center">0.08</td>
<td align="center">0.12</td>
<td align="center">1.57</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">rkf45</td>
<td align="center">12.15</td>
<td align="center">0.39</td>
<td align="center">0.12</td>
<td align="center">0.08</td>
<td align="center">0.12</td>
<td align="center">1.62</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">rk2</td>
<td align="center">11.73</td>
<td align="center">0.36</td>
<td align="center">0.10</td>
<td align="center">0.07</td>
<td align="center">0.11</td>
<td align="center">1.44</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="dose-response-approach">Dose Response Approach<a class="anchor" aria-label="anchor" href="#dose-response-approach"></a>
</h2>
<p>Instead, we can also simulate this model as a dose response curve.
This is done in a copy of the model that doens’t have the <code>s</code>
suffix (for <em>sequential</em>).</p>
<p>In this formulation of the model, we need to be able to reach each
steady state from the default initial conditions, not just from a very
nearby previous steady state. So, we give the system more time to reach
it (600 seconds <code>!Time</code> for each data point). Because of this
longer time, this is a less efficient approach. The advantage is that it
avoids event schedules and transformations entirely.</p>
<pre><code>!!SBtab SbtabVersion='1.0'  Document='CaMKII'   TableType='QuantityMatrix'  TableName='Experiments'
!ID                 !Type          &gt;Ca_set  &gt;PP1_0  &gt;CaMKII_0  &gt;CaM_0  &gt;PP2B_0  &gt;cab  !T0   !Event  !Time
Bradshaw2003Fig2E   Dose Response  -1       0       200        2000    0        0     -100  TurnOn  600
Shifman2006Fig1Bsq  Dose Response  -1       0       5000       5000    0        0     -100  TurnOn  600
ODonnel2010Fig3Co   Dose Response  0        0       0          -1      100      0     -100  TurnOn  600
Stemmer1993Fig1tr   Dose Response  -1       0       0          300     3        0     -100  TurnOn  600
Stemmer1993Fig1fc   Dose Response  -1       0       0          30      3        0     -100  TurnOn  600
Stemmer1993Fig2Afc  Dose Response  -1       0       0          25000   0        0     -100  TurnOn  600</code></pre>
<p>The data files look different, they map inputs to outputs, rather
than time to outputs:</p>
<pre><code>!!SBtab Document='CaMKII' TableType='QuantityMatrix' TableName='Bradshaw2003Fig2E'
!ID    &gt;Ca_set  &gt;AutoCaMKII  ~AutoCaMKII
E0D0   175.8    1.04         11.9953
E0D1   236      1.38         11.9953
E0D2   313.3    1.04         11.9953
E0D3   426.6    1.04         11.9953
E0D4   564.9    1.04         11.9953
E0D5   749.9    3.46         11.9953
E0D6   1006.9   7.63         11.9953
E0D7   1336.6   29.47        11.9953
E0D8   1794.7   60.34        11.9953
E0D9   2349.6   82.19        11.9953
E0D10  3198.9   93.98        11.9953
E0D11  4246.2   95.37        11.9953
E0D12  5623.4   102.65       11.9953
E0D13  7568.3   95.37        11.9953
E0D14  10303.9  100.92       11.9953
E0D15  13489.6  98.15        11.9953
E0D16  18113.4  103          11.9953</code></pre>
<p>And there are no events at all. This sequence of Ca doses will be
converted to one time series experiment per line; the dose
<code>!ID</code> will be used as the experiment name.</p>
<p>In this version each point is treated as an independent measurement,
unrelated to its neighbors. The doses and data points can be in any
order.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span>  <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/uqsa_example.html">uqsa_example</a></span><span class="op">(</span><span class="st">"CaMKII"</span><span class="op">)</span></span>
<span><span class="va">sb</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab_from_tsv.html" class="external-link">sbtab_from_tsv</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; [tsv] file[1] «Bradshaw2003Fig2E.tsv» belongs to Document «CaMKII»</span></span>
<span><span class="co">#&gt;  I'll take this as the Model Name.</span></span>
<span><span class="co">#&gt; Bradshaw2003Fig2E.tsv  Compartment.tsv  Compound.tsv  Constant.tsv  Experiments.tsv  Expression.tsv  Input.tsv  ODonnel2010Fig3Co.tsv  Output.tsv  Parameter.tsv  Reaction.tsv  Shifman2006Fig1Bsq.tsv  Spikes.tsv  SpikeSeries.tsv  Stemmer1993Fig1fc.tsv  Stemmer1993Fig1tr.tsv  Stemmer1993Fig2Afc.tsv  Transformation.tsv  TurnOn.tsv</span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab.data.html" class="external-link">sbtab.data</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cfile</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/uqsa_example.html">uqsa_example</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span>,f<span class="op">=</span><span class="st">"c"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">modelName</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/checkModel.html">checkModel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span>,<span class="va">cfile</span><span class="op">)</span></span>
<span><span class="co">#&gt; building a shared library from c source, and using GSL odeiv2 as backend (pkg-config is used here).</span></span>
<span><span class="co">#&gt; cc -shared -fPIC `pkg-config --cflags gsl` -o './CaMKII.so' '/tmp/RtmpAJRrSc/temp_libpath4a777745142a/uqsa/extdata/CaMKII/CaMKII_gvf.c' `pkg-config --libs gsl`</span></span>
<span><span class="va">rfile</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/uqsa_example.html">uqsa_example</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span>,pat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"^%s[.]R$"</span>,<span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">sb</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">rfile</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">CaMKII_default</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="va">ex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">input</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">startsWith</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span>,<span class="st">"E0"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## simulate the first subset:</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">uqsa</span><span class="fu">::</span><span class="fu"><a href="../reference/simulator.c.html">simulator.c</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">modelName</span>,method <span class="op">=</span> <span class="fu">rgsl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgsl/man/integrationMethod.html" class="external-link">integrationMethod</a></span><span class="op">(</span><span class="st">"msadams"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">s</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cpuSeconds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">y</span>,\<span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="va">l</span><span class="op">$</span><span class="va">cpuSeconds</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cpuSeconds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cpuSeconds</span><span class="op">)</span></span>
<span><span class="co">#&gt;     E0D0     E0D1     E0D2     E0D3     E0D4     E0D5     E0D6     E0D7 </span></span>
<span><span class="co">#&gt; 5.230821 5.159520 5.295578 5.148994 5.168618 5.192885 5.187591 5.250753 </span></span>
<span><span class="co">#&gt;     E0D8     E0D9    E0D10    E0D11    E0D12    E0D13    E0D14    E0D15 </span></span>
<span><span class="co">#&gt; 5.414976 5.411192 5.523694 6.790849 6.586266 6.686983 7.443709 6.741364 </span></span>
<span><span class="co">#&gt;    E0D16 </span></span>
<span><span class="co">#&gt; 4.987958</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">i</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputValues</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Ca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">input</span><span class="op">[</span><span class="st">'Ca_set'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,\<span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">$</span><span class="va">func</span><span class="op">[</span><span class="va">o</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">v_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">outputValues</span><span class="op">[[</span><span class="va">o</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">errorValues</span><span class="op">[[</span><span class="va">o</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>bty<span class="op">=</span><span class="st">"n"</span>,xlog<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">yLabel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputValues</span><span class="op">)</span><span class="op">[</span><span class="va">o</span><span class="op">]</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sb</span><span class="op">$</span><span class="va">Experiments</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Ca</span>,<span class="va">f_</span>,pch<span class="op">=</span><span class="fl">2</span>,xlab<span class="op">=</span><span class="st">'Ca'</span>,ylab<span class="op">=</span><span class="va">yLabel</span>,main<span class="op">=</span><span class="va">E</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">120</span><span class="op">)</span>,log<span class="op">=</span><span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="va">Ca</span>,<span class="va">v_</span>,<span class="va">Ca</span>,<span class="va">v_</span><span class="op">+</span><span class="va">e_</span>,angle<span class="op">=</span><span class="fl">90</span>,length<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">Ca</span>,<span class="va">v_</span>,pch<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="va">Ca</span>,<span class="va">v_</span>,<span class="va">Ca</span>,<span class="va">v_</span><span class="op">-</span><span class="va">e_</span>,angle<span class="op">=</span><span class="fl">90</span>,length<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="smmala_files/figure-html/plots-1.png" width="700"></p>
<p>Here the triangles represent the independent simulation results.</p>
<p>This approach lends itself more to parallelization than the dose
sequence, because all these independent points can be simulated in
parallel (all 99 points, within each curve and between the curves). But,
if a small number of the points require a long simulation time, then
their solution will pause the entire Markov chain until all points have
been obtained.</p>
<p>Therefore, it may be much better to simulate all experiments
sequentially (see previous section), and instead start more parallel
Markov chains (and merge them in the end). This way, fewer
MPI-workers/threads/cores idle.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alexandra Jauhiainen, Olivia Eriksson, Federica Milinanni, Andrei Kramer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
