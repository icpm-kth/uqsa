<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="uqsa">
<title>Source Code Principles (Devs) • uqsa</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Source Code Principles (Devs)">
<meta property="og:description" content="uqsa">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">uqsa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/uqsa.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-installation">Installation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-installation">
    <a class="dropdown-item" href="../articles/installation.html">Short Instructions</a>
    <a class="dropdown-item" href="../articles/installExplanations.html">Explanation for System Prerequisites</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-documentation">Documentation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-documentation">
    <a class="dropdown-item" href="../articles/SBtab.html">SBtab</a>
    <a class="dropdown-item" href="../articles/models.html">Importing Models</a>
    <a class="dropdown-item" href="../articles/data.html">Importing Data</a>
    <a class="dropdown-item" href="../articles/simulate.html">Simulating a model</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/UQ.html">Uncertainty Quantification</a>
    <a class="dropdown-item" href="../articles/GSA.html">Global Sensitivity Analysis</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/more_details.html">More details...</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/examples_overview.html">Overview</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>AKAR4</h6>
    <a class="dropdown-item" href="../articles/simAKAR4.html">Simulate deterministic AKAR4</a>
    <a class="dropdown-item" href="../articles/simAKAR4stochastic.html">Simulate stochastic AKAR4</a>
    <a class="dropdown-item" href="../articles/sampleAKAR4.html">UQ on deterministic AKAR4</a>
    <a class="dropdown-item" href="../articles/sampleAKAR4stochastic.html">UQ on stochasic AKAR4</a>
    <a class="dropdown-item" href="../articles/GSA_AKAR4.html">GSA on AKAR4</a>
    <a class="dropdown-item" href="../articles/uqsaAKAR4.html">UQ and SA on AKAR4</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>AKAP79</h6>
    <a class="dropdown-item" href="../articles/sampleAKAP79.html">UQ on deterministic AKAP79</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>CaMKII</h6>
    <a class="dropdown-item" href="../articles/smmala.html">Calibrate CaMKII with SMMALA</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>CRNN</h6>
    <a class="dropdown-item" href="../articles/crnn.html">CRNN models</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Extra</h6>
    <a class="dropdown-item" href="../articles/extraExamples.html">More examples...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Source Code Principles (Devs)</h1>
            
      
      
      <div class="d-none name"><code>code-principles.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://icpm-kth.github.io/uqsa/">uqsa</a></span><span class="op">)</span></span></code></pre></div>
<p>Many of these things are subject to change. Some function names seem
inconsistent (naming patterns), because they were written by different
people. We will improve naming coherence slowly and carefully.</p>
<p>One of our goals is to keep dependencies minimal and recreate
functionality in other packages, if this is easy to do. We use external
packages when a feature is good, and difficult to replicate.</p>
<div class="section level2">
<h2 id="objects">Objects<a class="anchor" aria-label="anchor" href="#objects"></a>
</h2>
<p>We do not define <em>S3</em>, or <em>S4</em> objects for this
package. All functions accept/return base R types (vectors, lists,
matrices, data.frames). We may occasionally use objects from other
packages.</p>
</div>
<div class="section level2">
<h2 id="closures">Closures<a class="anchor" aria-label="anchor" href="#closures"></a>
</h2>
<p>The MCMC code tries to follow the mathematical formulation of the
subject (in literature). The goal is to make it easy to read the
code.</p>
<p>A probability distribution typically takes a main argument, and
several <em>given</em> values. Whenever we want to distinguish the
<em>main</em> argument from the others, we typically create a closure.
Let’s consider the likelihood function:</p>
<p><span class="math display">\[
\begin{align}
p(y|\theta,M) &amp;=
\frac{1}{\sqrt{2\pi\sigma^2}}\exp\left(-\frac{1}{2}\sum_{i,j}\left(\frac{y_{ij}
- h_i(x(t_j;\theta,M))}{\sigma}\right)^2\right)\,,\\
L(\theta;y,M) &amp;= p(y|\theta,M)\,,
\end{align}
\]</span></p>
<p>where <span class="math inline">\(L\)</span> is the likelihood
function (its main argument is <span class="math inline">\(\theta\)</span>, separated by <code>;</code>). The
Likelihood’s argument list omits several implict items:</p>
<ul>
<li>given
<ul>
<li>
<span class="math inline">\(M\)</span> is the model,</li>
<li>
<span class="math inline">\(y_{ij}\)</span> are the measured data
points (for time-point <span class="math inline">\(j\)</span> and output
<span class="math inline">\(i\)</span>),</li>
</ul>
</li>
<li>omitted is the
<ul>
<li>ODE solver and integration method,</li>
<li>the details of the simulation experiment (such as <em>initial
values</em>, and <em>input parameters</em> – if they exist),</li>
<li>the output function <span class="math inline">\(h\)</span> used to
map the model’s state <span class="math inline">\(x\)</span> to the
vector space of <span class="math inline">\(y\)</span>
</li>
<li>the measurement time vector <span class="math inline">\(t\)</span>
</li>
</ul>
</li>
</ul>
<p>These itmes are omitted because it would be very tedious to write
them every time. In a manuscript, we would mention these implicit
dependencies once and then omit for the ease of notation.</p>
<p>We want to replicate this distinction between explicit and implicit
arguments in our code, and avoid writing long lists of arguments, most
of which stay the same throughout a program’s run-time.</p>
<p>We deal with this by creating closures, e.g. for the solver (roughly
equivalent to <span class="math inline">\(h\)</span> and <span class="math inline">\(x\)</span>):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulator.c.html">simulator.c</a></span><span class="op">(</span><span class="va">experiments</span>,<span class="va">modelName</span><span class="op">)</span>  <span class="co"># returns a closure</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">s</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>                            <span class="co"># with one main argument</span></span></code></pre></div>
<p>The value <code>z</code> contains the model’s state <span class="math inline">\(x\)</span> and output values <span class="math inline">\(h(x(\dots))\)</span>:</p>
<ul>
<li>
<code>z[[k]]$state</code> is roughly equivalent to <span class="math inline">\(x(t;\theta,M)\)</span> for experiment <span class="math inline">\(k\)</span>
</li>
<li>
<code>z[[k]]$func</code> is roughly equivalent to <span class="math inline">\(h(x(t;\theta,M))\)</span>
</li>
</ul>
<p>The closure <code>s</code> is a function of only <span class="math inline">\(\theta\)</span>. Enclosed within <code>s</code>
are:</p>
<ul>
<li>The model <span class="math inline">\(M\)</span>
<ul>
<li>represented by <code>modelName</code>, and the corresponding shared
library,</li>
<li>
<code>./path/to/model.so</code> (or whichever path applies)</li>
</ul>
</li>
<li>The simulation experiment to perform
<ul>
<li><code>experiments</code></li>
</ul>
</li>
</ul>
<p>We don’t have to re-state these when calling the solver. The benefits
increase when the number of implicit, unchanging arguments
increases.</p>
<p>Similarly, the likelihood is also a closure around the experiments.
But, to keep this function fairly general, it isn’t a closure around the
simulator:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logLikelihoodFunc.html">logLikelihoodFunc</a></span><span class="op">(</span><span class="va">experiments</span><span class="op">)</span> <span class="co"># a closure</span></span>
<span><span class="fu">L</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>                            <span class="co"># with one main argument, theta</span></span></code></pre></div>
<p>The user can create their own likelihood function that does in fact
enclose the solver as well.</p>
<p>The model’s solution doesn’t have to be derived from an ODE using one
of our solvers, it may be a stochastic solver, or an external solver
such as deSolve.</p>
<p>Crucially, the solver may return a value that the MCMC update
function may require to work properly. We don’t want to call the solver
twice, and the simulatiuon results <code>z</code> are of course not
implicit as they depend on the main argument <code>theta</code>. We may
need <code>z</code> in:</p>
<ol style="list-style-type: decimal">
<li>the update function</li>
<li>the likelihood function</li>
<li>other follow-up functions</li>
</ol>
<p>But, a solution must always travel together with the parameters <span class="math inline">\(\theta\)</span> that the solution was obtained
for. They must become a paired entity. But, we also want to keep the
idea that <code>theta</code> is the <em>main</em> variable for MCMC
sampling or optimization, rather than turning these two items into a
list: <code>list(theta=theta,simulations=s(theta))</code></p>
<p>As a workaround, we use attributes:
<code>attr(theta,"simulations") &lt;- s(theta)</code></p>
<div class="section level3">
<h3 id="attributes">Attributes<a class="anchor" aria-label="anchor" href="#attributes"></a>
</h3>
<p>Attributes can be attached to any variable, using the
<code>attr</code> function. A function can work on theta without even
knowing about the existence of the attributes.</p>
<p>If the likeihood function needs <em>any</em> implicit values, they
are attached to theta as attributes: fisher information, gradient of the
log-likelihood, prior probability of theta are all attached as
attributes.</p>
<div class="section level4">
<h4 id="example-of-a-custom-likelihood">Example of a Custom Likelihood<a class="anchor" aria-label="anchor" href="#example-of-a-custom-likelihood"></a>
</h4>
<p>Here is an example of a user-defined likelihood function that
references the attributes. The <code>mcmcUpdate(theta)</code> function
will call the solver and attach the results to the returned value (as
attributes). To see which attributes are attached by a specific update
function, the user can call the update funciton and inspect the
result.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab.data.html" class="external-link">sbtab.data</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logLikelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="st">"simulations"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">theta</span>,<span class="st">"simulations"</span><span class="op">)</span> <span class="co"># here, we know that y belongs to theta</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="co"># [...]</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>There are certainly disadvantages in using attributes: it is harder
to debug errors related to missing attributes. But, we prefer having the
distinction between the main argument (explicit) and implicit arguments
(enclosed or attributes).</p>
<p>A user may also circumvent the entire attribute system in a context
that doesn’t require any.</p>
</div>
<div class="section level4">
<h4 id="example-with-optimization">Example with Optimization<a class="anchor" aria-label="anchor" href="#example-with-optimization"></a>
</h4>
<p>In this example, we want to use an optimization routine from the
optimx package. Since we are not using any of the MCMC update functions,
there is no need to work with attributes at all.</p>
<p>Instead, we create some variables in the global scope, and use them
in the optimization function <code>fn</code> (all R functions can
reference the environment they were created in). Let us assume that
there is exactly one experiment.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu">SBtabVFGEN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SBtabVFGEN/man/sbtab.data.html" class="external-link">sbtab.data</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>    <span class="co"># load some data set</span></span>
<span></span>
<span><span class="va">modelName</span> <span class="op">&lt;-</span> <span class="st">"my_model"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/comment.html" class="external-link">comment</a></span><span class="op">(</span><span class="va">modelName</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"./my_model.so"</span></span>
<span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulator.c.html">simulator.c</a></span><span class="op">(</span><span class="va">ex</span>,<span class="va">modelName</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"optimx"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="co">##  user code, using the variables ex, and s implicitly</span></span>
<span>    <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">{</span>           <span class="co"># function to minimize</span></span>
<span>        <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">s</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>                <span class="co"># simulate</span></span>
<span>        <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">z</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">func</span><span class="op">)</span>       <span class="co"># extract model output</span></span>
<span>        <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outputValues</span><span class="op">)</span> <span class="co"># get measured data</span></span>
<span>        <span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">errorValues</span><span class="op">)</span> <span class="co"># and standard error</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>                <span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">h</span><span class="op">)</span><span class="op">/</span><span class="va">sd</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>                na.rm<span class="op">=</span><span class="cn">TRUE</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">optimx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/optimx/man/optimx.html" class="external-link">optimx</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="co"># use fn</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Normally <code>s</code> will loop over several columns of
<code>as.matrix(theta)</code> and return 3-dimensional arrays:
<code>length(dim(z[[1]]$func))==3</code> (same for state). For one
vector <code>theta</code>, the third dimension is 1:
<code>dim(z[[1]]$func))[3] == NCOL(theta) == 1</code> (for vectors).</p>
<p>This third dimension can be dropped (<code>drop</code>) if none of
the other dimension’s are singular.</p>
<p><em>Remark:</em> We are aware of this possibility, to use variables
in the global environment, but for package functions, we want it to be
immediately apparent where a value comes from (by reading the function’s
code). Package functions must (of course) make no assumptions about
variables in the user’s global environment.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="abc">ABC<a class="anchor" aria-label="anchor" href="#abc"></a>
</h2>
<p>Some of the ABC code was created before these decisions were made and
may require some adjustment still.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexandra Jauhiainen, Olivia Eriksson, Federica Milinanni, Andrei Kramer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
